# 要件定義書: LINEタスク管理Bot

## 1. システム概要
LINE公式アカウント上で動作する、個人用タスク管理およびリコメンドBot。
無料プランの制限内で運用するため、ユーザーからの問いかけに応答する「プル型」の設計を基本とする。
個人利用とグループ利用の両方をサポートし、データのプライバシーと文脈の分離を確保する。

## 2. コンセプト
- **プラットフォーム**: LINE Messaging API (未認証アカウント)
- **ターゲット**: 個人利用 + 友人/グループ (誰でも追加可能)
- **提供価値**: チャットによる手軽なタスク管理と、AIによる最適なタスク提案。

## 3. 機能要件

### 3.1. タスク管理 (CRUD)
- **登録**:
    - テキストメッセージでタスクを登録可能。
    - 自然言語入力に対応（例：「明日牛乳を買う」「20時に母に電話するようリマインドして」）。
- **一覧表示**:
    - 現在のタスクリストを表示可能。
    - 文脈（個人 vs グループ）によるフィルタリング。
- **完了**:
    - タスクを完了状態にできる。
- **削除**:
    - タスクを削除できる。

### 3.2. AIリコメンド & インタラクション
- **タスク提案**:
    - **トリガー**: ユーザーからの問いかけ（例：「次何すればいい？」「残りのタスクは？」）。
    - **ロジック**: AIが未完了タスク、現在時刻、文脈を分析し、最適なタスクを提案する。
- **自然言語理解 (NLU)**:
    - 自由記述の入力から意図（登録、一覧、完了、提案）を理解する。
- **引用返信によるタスク化**:
    - **機能**: グループ内や個人チャットで、過去のメッセージに対して「引用返信」を行うことで、そのメッセージ内容をタスクとして登録する。
    - **要件**: Botが過去のメッセージ内容を一時的にキャッシュ（保存）しておく必要がある（Message IDと内容の紐付け）。
- **メッセージ転送によるタスク化**:
    - **機能**: 他のチャットからのメッセージをBotに「転送」することでタスク登録する。

### 3.3. UI/UX & ユーザビリティ
- **リッチメニュー**:
    - **「タスクを確認」ボタン**: タップすると「タスク一覧」等のメッセージが送信され、Botがリストを返信する。
    - **「タスク登録」ボタン**: タップすると入力モードになる、または入力方法のガイドを表示する。
- **Flex Message (推奨機能)**:
    - タスク一覧をテキストではなく、視認性の高いカード形式（Flex Message）で表示する。
    - 各タスクに「完了」「削除」ボタンを配置し、ワンタップで操作可能にする。
- **スマート日時認識 (推奨機能)**:
    - 「明日10時」「来週の金曜日」などの相対日時を解析し、自動で期限を設定する。

### 3.3. グループ & マルチユーザー対応
- **コンテキスト認識**:
    - **個人チャット**: タスクはそのユーザーのプライベートなものとして扱う。
    - **グループチャット**: タスクはそのグループ内で共有されるものとして扱う。
- **プライバシー**:
    - グループAのタスクは、グループBや個人チャットからは見えないようにする。
    - 個人のタスクは、グループチャットからは見えないようにする。

## 4. 非機能要件

### 4.1. 制約 & クォータ管理
- **メッセージ数制限**: 月間200通（無料プラン）。
- **戦略**:
    - **基本**: ユーザー発信の対話には、無料・無制限の**Reply API（応答メッセージ）**を使用する。
    - **例外**: **Push API**は、ユーザーが明示的に設定した重要なアラート等に限定し、厳格に制限する。
    - **グループ**: グループ内でのPush API利用は、大量消費（人数分カウント）を防ぐため原則禁止とする。

### 4.2. セキュリティ & プライバシー
- **ユーザーID**: LINE User ID（プロバイダ固有ID）を使用して識別する。
- **グループID**: LINE Group IDを使用してグループコンテキストを識別する。
- **データ保存**: `owner_id`（User ID または Group ID）を持つセキュアなデータベース（Firestore, Supabase等）に保存する。

## 5. データモデル (概念)

### User (ユーザー)
- `line_user_id` (PK): String
- `display_name`: String
- `created_at`: Timestamp

### Group (グループ)
- `line_group_id` (PK): String
- `group_name`: String (取得可能な場合)
- `created_at`: Timestamp

### Task (タスク)
- `task_id` (PK): UUID
- `owner_id`: String (FK: User.line_user_id または Group.line_group_id)
- `owner_type`: Enum ('USER', 'GROUP')
- `content`: String
- `status`: Enum ('PENDING', 'DONE')
- `due_date`: Timestamp (任意)
- `created_at`: Timestamp
- `created_by`: String (作成者のline_user_id)

## 6. 技術スタック (案)
- **バックエンド**: Cloud Functions (Firebase) または Hono (Cloudflare Workers) 等のサーバーレス環境。
- **データベース**: Firestore または Supabase (PostgreSQL)。
- **AI**: OpenAI API (GPT-4o/mini) または Gemini API (NLUおよびリコメンド用)。
- **インターフェース**: LINE Messaging API SDK。
